<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.spring.project.student.dao.StudentDAO">
	<!-- 수강신청 목록 갯수 구하기 -->
	<select id="getLectureCnt" resultType="int">
		select count(*) from lecture
	</select>
	
	<!-- 수강신청 목록 조회 -->
	<select id="lectureList" parameterType="int" resultType="com.spring.project.student.vo.LectureVO">
		<![CDATA[
		select * from lectureview where rNum >= #{start} and rNum <= #{end}
		]]>
	</select>
	
	<!-- 강의 검색 리스트 갯수 -->
	<select id="getLectureSearchCnt" parameterType="String" resultType="int">
		select count(*) from lectureview where lectureName like '%'||#{keyword}||'%'
	</select>
	
	<!-- 강의 검색 -->
	<select id="lectureSearch" parameterType="Object" resultType="com.spring.project.student.vo.LectureVO">
		<![CDATA[
		select * from lectureview where lectureName like '%'||#{keyword}||'%' and rNum >= #{start} and rNum <= #{end}
		]]>
	</select>
	
	<!-- 강의 검색 -->
	<select id="schoolTimeTable" parameterType="String" resultType="com.spring.project.student.vo.LectureVO">
		<![CDATA[
		select * from timetableview where userNumber = #{userNumber}
		]]>
	</select>
	
	<!-- 강의 체크 -->
	<select id="checkLecture" parameterType="java.util.Map" resultType="int">
		select count(*) from timetableview 
			where timetblCode in (SELECT timetblCode
          							from timetableview 
         							 where lecCode=#{lecCode} and userNumber=#{userNumber})
	</select>
	
	<!-- 강의 인원수 체크 -->
	<select id="checkStudentInLecture" parameterType="String" resultType="int">
		select count(*) from studentClassInfo where lecCode=#{lecCode}
	</select>
	
	<!-- 강의 인원수 체크 -->
	<select id="checkStudentInLecture2" parameterType="int" resultType="int">
		select count(*) from lecture where maximumCapacity >= #{selectCnt} and #{lecCode};
	</select>
	
	
	<!-- 강의 신청 -->
	<insert id="applyLecture" parameterType="java.util.Map">
		insert into studentClassInfo(infoCode, lecCode, userNumber, status) 
		values(STUDENTCLASSINFO_SEQ.nextval,#{lecCode},#{userNumber},1)
	</insert>
</mapper>